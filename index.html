<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>VRæ£®ã®æ˜Ÿæ¢ã—ã‚²ãƒ¼ãƒ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #87CEEB;
      font-family: system-ui, sans-serif;
    }
    
    .hud {
      position: fixed;
      left: 0;
      right: 0;
      top: 0;
      padding: 15px;
      color: #2F4F2F;
      text-align: center;
      pointer-events: none;
      background: rgba(255,255,255,0.9);
      font-size: 16px;
    }
    
    .vr-button {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: #FF6B6B;
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      pointer-events: all;
    }
    
    .vr-button:hover {
      background: #FF5252;
    }
  </style>
</head>
<body>
  <div class="hud">
    ğŸŒŸ æ£®ã®ä¸­ã®æ˜Ÿã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼ä¸­å¤®ã®ä¸¸ã§ç‹™ã£ã¦è¦‹ã¤ã‚ã‚‹ï¼ˆã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ï¼‰ã§å›åã§ãã‚‹ã‚ˆ
  </div>
  
  <button class="vr-button" onclick="enterVRMode()">ğŸ¥½ VRãƒ¢ãƒ¼ãƒ‰ã§éŠã¶</button>

  <a-scene renderer="colorManagement: true; physicallyCorrectLights: true" background="color: #87CEEB">
    <!-- ã‚¢ã‚»ãƒƒãƒˆ -->
    <a-assets>
      <audio id="star-sound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmIbBzeVyOzNdykFJH/A6NyRQAoUYK7q5KJTFT1Dv+z5sGAaFzKS2OnIdiYGOoO87NOFOAgbYLTm47NUFApGntjxvF4aFzGQ1O/JdCUFN4K+8N2SQw8VPa/u7qBBFA1A0PTYx3krFz6S2ezXZDEPJ4G47+CdQBA4k9j94qtjGBIEruPmn1MKFi/D9NuJLQMgLKjz2plJGwMw0fDXik8DCy+59+OJKQAFp/z1lnH/C0HN7N6HPgAAp+Xdz58AAAAAAAAAAAAAAAlhZmZwAAAAAAAAAAAAAAAAAAAAAgAAACtaVGmwAABYWnQpAAAAAADY2thOAAAAWFp0NQAAAAC4uLhOAQAAWFp0IQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0KQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0KQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0KQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOaaaaa" preload="auto"></audio>
    </a-assets>

    <!-- ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚° -->
    <a-entity light="type: ambient; intensity: 0.6; color: #ffffff"></a-entity>
    <a-entity light="type: directional; intensity: 0.8; castShadow: true" position="5 10 5"></a-entity>

    <!-- åœ°é¢ï¼ˆè‰åŸï¼‰ -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="30" height="30" 
             material="color: #228B22; roughness: 1"></a-plane>

    <!-- æ£®ã®æœ¨ã€… -->
    <!-- å¤§ããªæœ¨1 -->
    <a-entity position="-8 0 -8">
      <a-cylinder radius="0.8" height="6" color="#8B4513" position="0 3 0"></a-cylinder>
      <a-sphere radius="3.5" color="#228B22" position="0 7 0"></a-sphere>
    </a-entity>
    
    <!-- å¤§ããªæœ¨2 -->
    <a-entity position="12 0 -10">
      <a-cylinder radius="1" height="8" color="#8B4513" position="0 4 0"></a-cylinder>
      <a-sphere radius="4" color="#228B22" position="0 9 0"></a-sphere>
    </a-entity>
    
    <!-- å¤§ããªæœ¨3 -->
    <a-entity position="-15 0 5">
      <a-cylinder radius="1.2" height="7" color="#8B4513" position="0 3.5 0"></a-cylinder>
      <a-sphere radius="4.5" color="#228B22" position="0 8.5 0"></a-sphere>
    </a-entity>

    <!-- ä¸­ãã‚‰ã„ã®æœ¨ã€… -->
    <a-entity position="8 0 8">
      <a-cylinder radius="0.6" height="4" color="#8B4513" position="0 2 0"></a-cylinder>
      <a-sphere radius="2.5" color="#2F4F2F" position="0 5 0"></a-sphere>
    </a-entity>
    
    <a-entity position="-5 0 10">
      <a-cylinder radius="0.5" height="3.5" color="#8B4513" position="0 1.75 0"></a-cylinder>
      <a-sphere radius="2" color="#228B22" position="0 4.2 0"></a-sphere>
    </a-entity>

    <!-- èŒ‚ã¿ã¨èŠ± -->
    <a-sphere position="4 0.8 5" radius="1.5" color="#228B22"></a-sphere>
    <a-sphere position="-3 0.6 -3" radius="1.2" color="#2F4F2F"></a-sphere>
    <a-sphere position="7 0.7 -2" radius="1.3" color="#228B22"></a-sphere>
    
    <!-- èŠ± -->
    <a-entity position="3 0 2">
      <a-cylinder radius="0.05" height="0.8" color="#90EE90" position="0 0.4 0"></a-cylinder>
      <a-sphere radius="0.25" color="#FF69B4" position="0 0.9 0"></a-sphere>
    </a-entity>
    
    <a-entity position="-2 0 4">
      <a-cylinder radius="0.04" height="0.6" color="#90EE90" position="0 0.3 0"></a-cylinder>
      <a-sphere radius="0.2" color="#FFB6C1" position="0 0.7 0"></a-sphere>
    </a-entity>

    <!-- ã‚«ãƒ¡ãƒ©ï¼ˆfuseã‚«ãƒ¼ã‚½ãƒ« + ãƒ¬ã‚¤ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ï¼‰ -->
    <a-entity id="rig" position="0 1.6 3">
      <a-camera wasd-controls>
        <a-cursor
          fuse="true"
          fuse-timeout="1000"
          raycaster="objects: .star"
          material="color: #FFD700; shader: flat"
          geometry="radiusInner: 0.02; radiusOuter: 0.03"
        ></a-cursor>

        <!-- ã‚µã‚¦ãƒ³ãƒ‰ï¼šã‚«ãƒ¡ãƒ©ã®å­ã«ã—ã¦ non-positional ã§ç¢ºå®Ÿã«èã“ãˆã‚‹ -->
        <a-entity id="sfx" sound="src: #star-sound; positional: false; volume: 0.7"></a-entity>
      </a-camera>
    </a-entity>

    <!-- ã‚¹ã‚³ã‚¢UI -->
    <a-entity id="ui" position="0 2.8 -1.5">
      <a-plane width="2" height="0.6" color="#228B22" material="opacity: 0.9" position="0 0 0"></a-plane>
      <a-entity id="score" text="value: 0 / 5; color: white; align: center; width: 4" position="0 0 0.01"></a-entity>
    </a-entity>

    <!-- ãŠã‚ã§ã¨ã†UI -->
    <a-entity id="congrats" visible="false" position="0 2.2 -1.8">
      <a-plane width="3" height="1.5" color="#FFD700" material="opacity: 0.95" position="0 0 0"></a-plane>
      <a-entity text="value: ğŸ‰ ãŠã‚ã§ã¨ã†ï¼; color: #333; align: center; width: 5" position="0 0.4 0.01"></a-entity>
      <a-entity text="value: ã™ã¹ã¦ã®æ˜Ÿã‚’è¦‹ã¤ã‘ãŸã­ï¼; color: #333; align: center; width: 4" position="0 0.1 0.01"></a-entity>
      <a-entity text="value: ã‚‚ã†ä¸€åº¦éŠã¶; color: #333; align: center; width: 3" position="0 -0.2 0.01"></a-entity>
      <a-plane id="restartBtn" class="ui-btn" position="0 -0.5 0.02" width="1.5" height="0.4" color="#228B22"></a-plane>
    </a-entity>

    <!-- æ˜Ÿã®ç”Ÿæˆå…ˆ -->
    <a-entity id="stars-container"></a-entity>

    <!-- é›² -->
    <a-sphere position="20 12 -15" radius="3" color="#FFFFFF" opacity="0.8"></a-sphere>
    <a-sphere position="-25 14 -10" radius="2.5" color="#FFFFFF" opacity="0.8"></a-sphere>

    <script>
      // ===== è¨­å®š =====
      const TOTAL_STARS = 5;
      let foundStars = 0;

      // VRãƒ¢ãƒ¼ãƒ‰é–¢æ•°
      function enterVRMode() {
        const scene = document.querySelector('a-scene');
        if (scene && scene.enterVR) {
          scene.enterVR();
        } else {
          // A-Frameã®VRãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦ã‚¯ãƒªãƒƒã‚¯
          const vrButton = document.querySelector('.a-enter-vr-button');
          if (vrButton) {
            vrButton.click();
          } else {
            alert('VRãƒ˜ãƒƒãƒ‰ã‚»ãƒƒãƒˆãŒæ¤œå‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚PCãƒ¢ãƒ¼ãƒ‰ã§ãŠæ¥½ã—ã¿ãã ã•ã„ï¼');
          }
        }
      }

      // æ˜Ÿã®åé›†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
      AFRAME.registerComponent('star-collectible', {
        schema: { index: { type: 'int' } },
        init: function () {
          const el = this.el;

          // ãƒ›ãƒãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
          el.setAttribute('animation__hover', 
            'property: scale; startEvents: mouseenter; to: 1.3 1.3 1.3; dur: 200; easing: easeOutQuad');
          el.setAttribute('animation__unhover', 
            'property: scale; startEvents: mouseleave; to: 1 1 1; dur: 200; easing: easeOutQuad');

          // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
          el.addEventListener('click', () => {
            if (!el.getAttribute('visible')) return;

            // ã‚µã‚¦ãƒ³ãƒ‰å†ç”Ÿ
            const sfx = document.querySelector('#sfx');
            if (sfx && sfx.components && sfx.components.sound) {
              try { 
                sfx.components.sound.stopSound(); 
                sfx.components.sound.playSound(); 
              } catch(e) {
                console.log('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:', e);
              }
            }

            // æ˜ŸãŒæ¶ˆãˆã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            el.setAttribute('animation__collect', {
              property: 'scale', 
              to: '0.01 0.01 0.01', 
              dur: 300, 
              easing: 'easeInQuad'
            });
            
            el.setAttribute('animation__glow', {
              property: 'material.emissiveIntensity', 
              to: 2, 
              dur: 150, 
              easing: 'easeOutQuad'
            });

            setTimeout(() => {
              el.setAttribute('visible', false);
              updateScore();
            }, 320);
          });
        }
      });

      // ã‚¹ã‚³ã‚¢æ›´æ–°
      function updateScore() {
        foundStars += 1;
        const score = document.querySelector('#score');
        if (score) {
          score.setAttribute('text', 'value', `${foundStars} / ${TOTAL_STARS}`);
        }

        if (foundStars >= TOTAL_STARS) {
          setTimeout(() => {
            const ui = document.querySelector('#ui');
            const congrats = document.querySelector('#congrats');
            if (ui) ui.setAttribute('visible', false);
            if (congrats) {
              congrats.setAttribute('visible', true);
              congrats.setAttribute('animation__pop', 
                'property: scale; from: 0.5 0.5 0.5; to: 1 1 1; dur: 400; easing: easeOutBack');
            }
          }, 300);
        }
      }

      // ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ©Ÿèƒ½
      document.addEventListener('DOMContentLoaded', () => {
        const btn = document.querySelector('#restartBtn');
        if (btn) {
          btn.addEventListener('click', restartGame);
        }
      });

      function restartGame() {
        foundStars = 0;
        const score = document.querySelector('#score');
        if (score) score.setAttribute('text', 'value', `${foundStars} / ${TOTAL_STARS}`);
        
        const ui = document.querySelector('#ui');
        const congrats = document.querySelector('#congrats');
        if (ui) ui.setAttribute('visible', true);
        if (congrats) congrats.setAttribute('visible', false);

        clearStars();
        spawnStars();
      }

      function clearStars() {
        const container = document.querySelector('#stars-container');
        if (!container) return;
        while (container.firstChild) {
          container.removeChild(container.firstChild);
        }
      }

      // æ˜Ÿã®ãƒ©ãƒ³ãƒ€ãƒ é…ç½®
      function spawnStars() {
        const container = document.querySelector('#stars-container');
        if (!container) return;

        const positions = [
          { x: -7, y: 4, z: -7 },
          { x: 4.5, y: 1.8, z: 5 },
          { x: -2.5, y: 1.2, z: 3.5 },
          { x: 11, y: 8, z: -9 },
          { x: 8, y: 2.5, z: 7.5 }
        ];

        positions.forEach((pos, i) => {
          const star = document.createElement('a-dodecahedron');
          star.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
          star.setAttribute('radius', '0.4');
          star.setAttribute('color', '#FFD700');
          star.setAttribute('material', 'metalness: 0.3; roughness: 0.2; emissive: #FFD700; emissiveIntensity: 0.5');
          star.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear');
          star.setAttribute('star-collectible', `index: ${i}`);
          star.classList.add('star');

          container.appendChild(star);
        });
      }

      // A-Frameã®åˆæœŸåŒ–ã‚’å¾…ã£ã¦ã‚²ãƒ¼ãƒ é–‹å§‹
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(() => {
          spawnStars();
        }, 1000);
      });
    </script>
  </a-scene>
</body>
</html>
