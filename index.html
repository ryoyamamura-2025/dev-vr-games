<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>森の星探しゲーム</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
    }
    
    #ui {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px;
      border-radius: 10px;
      font-size: 18px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    #instructions {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: rgba(34, 139, 34, 0.9);
      color: white;
      padding: 15px;
      border-radius: 10px;
      font-size: 14px;
      max-width: 250px;
    }
    
    #victory {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1001;
      background: linear-gradient(45deg, #FFD700, #FFA500);
      color: #333;
      padding: 30px;
      border-radius: 20px;
      font-size: 24px;
      text-align: center;
      display: none;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      animation: bounce 0.5s ease-in-out;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translate(-50%, -50%) translateY(0); }
      40% { transform: translate(-50%, -50%) translateY(-10px); }
      60% { transform: translate(-50%, -50%) translateY(-5px); }
    }
  </style>
</head>
<body>
  <div id="ui">
    <div>⭐ 見つけた星: <span id="score">0</span> / 5</div>
  </div>
  
  <div id="instructions">
    <h3>🌟 星探しゲーム</h3>
    <p>森の中に隠れている5つの星を見つけよう！</p>
    <p>✨ 星をクリックすると音が鳴るよ</p>
    <p>🎮 マウスで見回したり、WASDで移動できるよ</p>
  </div>
  
  <div id="victory">
    <h2>🎉 おめでとう！</h2>
    <p>すべての星を見つけたね！</p>
    <button onclick="restartGame()" style="margin-top: 15px; padding: 10px 20px; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">もう一度遊ぶ</button>
  </div>

  <a-scene background="color: #87CEEB" vr-mode-ui="enabled: false">
    <!-- アセット定義 -->
    <a-assets>
      <!-- 効果音 -->
      <audio id="star-sound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmIbBjeVyOzNdykFJH/A6NyRQAoUYK7q5KJTFT1Dv+z5sGAaFzKS2OnIdiYGOoO87NOFOAgbYLTm47NUFApGntjxvF4aFzGQ1O/JdCUFN4K+8N2SQw8VPa/u7qBBFA1A0PTYx3krFz6S2ezXZDEPJ4G47+CdQBA4k9j94qtjGBIEruPmn1MKFi/D9NuJLQMgLKjz2plJGwMw0fDXik8DCy+59+OJKQAFp/z1lnH/C0HN7N6HPgAAp+Xdz58AAAAAAAAAAAAAAAlhZmZwAAAAAAAAAAAAAAAAAAAAAgAAACtaVGmwAABYWnQpAAAAAADY2thOAAAAWFp0NQAAAAC4uLhOAQAAWFp0IQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0KQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0KQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0KQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAABY2thOAAAAWFp0HQAAAAC4uLhOAAAAWFp0JQAAAACY2thOAAAAWFp0HQAAAAC4uLhOaaaaa"></audio>
    </a-assets>

    <!-- カメラとコントローラー -->
    <a-entity id="rig" movement-controls="fly: false" position="0 1.6 3">
      <a-entity camera look-controls wasd-controls></a-entity>
    </a-entity>

    <!-- 地面（草原） -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="30" height="30" color="#228B22" 
             shadow="receive: true"></a-plane>

    <!-- 森の背景 -->
    <!-- 大きな木々 -->
    <a-cylinder position="-8 2 -5" radius="0.8" height="4" color="#8B4513"></a-cylinder>
    <a-sphere position="-8 5 -5" radius="2.5" color="#228B22"></a-sphere>
    
    <a-cylinder position="10 2.5 -8" radius="1" height="5" color="#8B4513"></a-cylinder>
    <a-sphere position="10 6 -8" radius="3" color="#2F4F2F"></a-sphere>
    
    <a-cylinder position="-12 3 2" radius="1.2" height="6" color="#8B4513"></a-cylinder>
    <a-sphere position="-12 7.5 2" radius="3.5" color="#228B22"></a-sphere>
    
    <a-cylinder position="8 2 8" radius="0.9" height="4" color="#8B4513"></a-cylinder>
    <a-sphere position="8 5.5 8" radius="2.8" color="#2F4F2F"></a-sphere>

    <!-- 中くらいの木々 -->
    <a-cylinder position="5 1.5 -3" radius="0.5" height="3" color="#8B4513"></a-cylinder>
    <a-sphere position="5 4 -3" radius="1.8" color="#228B22"></a-sphere>
    
    <a-cylinder position="-5 1.8 6" radius="0.6" height="3.5" color="#8B4513"></a-cylinder>
    <a-sphere position="-5 4.5 6" radius="2" color="#2F4F2F"></a-sphere>
    
    <a-cylinder position="12 1.2 3" radius="0.4" height="2.5" color="#8B4513"></a-cylinder>
    <a-sphere position="12 3.2 3" radius="1.5" color="#228B22"></a-sphere>

    <!-- 小さな木々と茂み -->
    <a-sphere position="3 0.8 4" radius="1.2" color="#228B22"></a-sphere>
    <a-sphere position="-2 0.6 -2" radius="1" color="#2F4F2F"></a-sphere>
    <a-sphere position="6 0.7 7" radius="1.1" color="#228B22"></a-sphere>
    <a-sphere position="-7 0.5 -1" radius="0.9" color="#2F4F2F"></a-sphere>

    <!-- 花や草 -->
    <a-cylinder position="2 0.3 1" radius="0.1" height="0.6" color="#90EE90"></a-cylinder>
    <a-sphere position="2 0.8 1" radius="0.2" color="#FF69B4"></a-sphere>
    
    <a-cylinder position="-3 0.2 3" radius="0.1" height="0.4" color="#90EE90"></a-cylinder>
    <a-sphere position="-3 0.5 3" radius="0.15" color="#FFB6C1"></a-sphere>
    
    <a-cylinder position="7 0.25 -1" radius="0.1" height="0.5" color="#90EE90"></a-cylinder>
    <a-sphere position="7 0.6 -1" radius="0.18" color="#FF1493"></a-sphere>

    <!-- 隠れた星たち（クリック可能） -->
    <!-- 星1: 木の後ろ -->
    <a-dodecahedron class="star" position="-7.5 3.5 -4.8" radius="0.3" color="#FFD700" 
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 4000"
                    shadow="cast: true"></a-dodecahedron>
    
    <!-- 星2: 茂みの中 -->
    <a-dodecahedron class="star" position="3.2 1.5 4.1" radius="0.25" color="#FFD700" 
                    animation="property: rotation; to: 360 0 360; loop: true; dur: 3500"
                    shadow="cast: true"></a-dodecahedron>
    
    <!-- 星3: 花の近く -->
    <a-dodecahedron class="star" position="-2.8 0.8 2.8" radius="0.28" color="#FFD700" 
                    animation="property: rotation; to: 0 360 180; loop: true; dur: 4200"
                    shadow="cast: true"></a-dodecahedron>
    
    <!-- 星4: 大きな木の上 -->
    <a-dodecahedron class="star" position="9.8 7.5 -7.5" radius="0.32" color="#FFD700" 
                    animation="property: rotation; to: 180 360 0; loop: true; dur: 3800"
                    shadow="cast: true"></a-dodecahedron>
    
    <!-- 星5: 地面近くの隠れた場所 -->
    <a-dodecahedron class="star" position="11.5 0.5 2.8" radius="0.27" color="#FFD700" 
                    animation="property: rotation; to: 360 180 360; loop: true; dur: 4100"
                    shadow="cast: true"></a-dodecahedron>

    <!-- 照明 -->
    <a-light type="ambient" color="#404040" intensity="0.6"></a-light>
    <a-light type="directional" position="5 10 5" color="#FFF8DC" intensity="0.8" 
             shadow="cast: true; mapSize: 2048"></a-light>
    
    <!-- 空 -->
    <a-sky color="#87CEEB"></a-sky>
    
    <!-- 雲 -->
    <a-sphere position="15 8 -10" radius="2" color="#FFFFFF" opacity="0.8"></a-sphere>
    <a-sphere position="18 8.5 -9" radius="1.5" color="#FFFFFF" opacity="0.8"></a-sphere>
    <a-sphere position="16 8.2 -8" radius="1.8" color="#FFFFFF" opacity="0.8"></a-sphere>
    
    <a-sphere position="-20 9 -5" radius="2.2" color="#FFFFFF" opacity="0.7"></a-sphere>
    <a-sphere position="-18 9.3 -4" radius="1.7" color="#FFFFFF" opacity="0.7"></a-sphere>
  </a-scene>

  <script>
    let starsFound = 0;
    const totalStars = 5;
    
    // Web Audio APIで効果音を生成
    function createStarSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
      oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.3);
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.type = 'sine';
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    }
    
    // 勝利音を作成
    function createVictorySound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      
      // メロディーの音程
      const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
      
      notes.forEach((freq, index) => {
        setTimeout(() => {
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
          
          oscillator.type = 'triangle';
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.4);
        }, index * 150);
      });
    }
    
    // A-Frameが読み込まれた後にイベントリスナーを設定
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        const stars = document.querySelectorAll('.star');
        
        stars.forEach((star, index) => {
          star.addEventListener('click', function() {
            // 既に見つけられた星はスキップ
            if (this.classList.contains('found')) return;
            
            // 星を見つけた！
            this.classList.add('found');
            starsFound++;
            
            // 星の色を変更してキラキラエフェクト追加
            this.setAttribute('color', '#FFFFFF');
            this.setAttribute('animation', 
              'property: scale; to: 1.5 1.5 1.5; loop: true; dir: alternate; dur: 500');
            
            // 効果音再生
            try {
              createStarSound();
            } catch (e) {
              console.log('音声再生に失敗しました');
            }
            
            // スコア更新
            document.getElementById('score').textContent = starsFound;
            
            // 全ての星を見つけたかチェック
            if (starsFound === totalStars) {
              setTimeout(() => {
                document.getElementById('victory').style.display = 'block';
                try {
                  createVictorySound();
                } catch (e) {
                  console.log('勝利音の再生に失敗しました');
                }
              }, 500);
            }
          });
          
          // ホバーエフェクト
          star.addEventListener('mouseenter', function() {
            if (!this.classList.contains('found')) {
              this.setAttribute('animation__hover', 
                'property: scale; to: 1.2 1.2 1.2; dur: 200');
            }
          });
          
          star.addEventListener('mouseleave', function() {
            if (!this.classList.contains('found')) {
              this.setAttribute('animation__hover', 
                'property: scale; to: 1 1 1; dur: 200');
            }
          });
        });
      }, 1000);
    });
    
    // ゲームリスタート機能
    function restartGame() {
      starsFound = 0;
      document.getElementById('score').textContent = '0';
      document.getElementById('victory').style.display = 'none';
      
      const stars = document.querySelectorAll('.star');
      stars.forEach(star => {
        star.classList.remove('found');
        star.setAttribute('color', '#FFD700');
        star.setAttribute('animation', 
          star.getAttribute('animation').replace('scale', 'rotation'));
      });
    }
  </script>
</body>
</html>
